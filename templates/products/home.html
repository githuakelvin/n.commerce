{% extends 'base.html' %}
{% load static %}

{% block title %}Kenya Commerce - Home{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section position-relative">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
        </div>

        <div class="carousel-inner">
            <div class="carousel-item active">
                <div class="hero-slide d-flex align-items-center"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6">
                                <div class="hero-content text-white">
                                    <h1 class="display-4 fw-bold mb-4">Welcome to Kenya Commerce</h1>
                                    <p class="lead mb-4">Discover amazing products with secure payments via M-Pesa, fast
                                        delivery across Kenya, and exceptional customer service.</p>
                                    <div class="hero-buttons">
                                        <a href="#featured-products" class="btn btn-light btn-lg me-3">
                                            <i class="fas fa-shopping-bag me-2"></i>Shop Now
                                        </a>
                                        <a href="#categories" class="btn btn-outline-light btn-lg">
                                            <i class="fas fa-th-large me-2"></i>Browse Categories
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 text-center">
                                <img src="{% static 'images/hero-1.png' %}" alt="Shopping" class="img-fluid hero-image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="hero-slide d-flex align-items-center"
                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6">
                                <div class="hero-content text-white">
                                    <h1 class="display-4 fw-bold mb-4">Secure M-Pesa Payments</h1>
                                    <p class="lead mb-4">Pay safely with M-Pesa integration. Quick, secure, and
                                        convenient payment processing for all your online purchases.</p>
                                    <div class="hero-buttons">
                                        <a href="#payment-methods" class="btn btn-light btn-lg me-3">
                                            <i class="fas fa-mobile-alt me-2"></i>Learn More
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 text-center">
                                <img src="{% static 'images/hero-2.png' %}" alt="M-Pesa Payment"
                                    class="img-fluid hero-image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="hero-slide d-flex align-items-center"
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6">
                                <div class="hero-content text-white">
                                    <h1 class="display-4 fw-bold mb-4">Fast Delivery Nationwide</h1>
                                    <p class="lead mb-4">Get your products delivered to your doorstep across all 47
                                        counties in Kenya. Reliable and fast delivery service.</p>
                                    <div class="hero-buttons">
                                        <a href="#delivery-info" class="btn btn-light btn-lg me-3">
                                            <i class="fas fa-truck me-2"></i>Delivery Info
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 text-center">
                                <img src="{% static 'images/hero-3.png' %}" alt="Delivery" class="img-fluid hero-image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>
</section>

<!-- Features Section -->
<section class="features-section py-5 bg-light">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">Why Choose Kenya Commerce?</h2>
                <p class="section-subtitle text-muted">We provide the best online shopping experience in Kenya</p>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-shield-alt fa-3x text-primary"></i>
                    </div>
                    <h5 class="feature-title mb-3">Secure Payments</h5>
                    <p class="feature-description text-muted">Multiple payment options including M-Pesa, cards, and cash
                        on delivery with bank-level security.</p>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-truck fa-3x text-success"></i>
                    </div>
                    <h5 class="feature-title mb-3">Fast Delivery</h5>
                    <p class="feature-description text-muted">Quick delivery across all counties in Kenya with real-time
                        tracking and SMS updates.</p>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-headset fa-3x text-info"></i>
                    </div>
                    <h5 class="feature-title mb-3">24/7 Support</h5>
                    <p class="feature-description text-muted">Round-the-clock customer support via WhatsApp, phone, and
                        email for all your queries.</p>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="feature-icon mb-3">
                        <i class="fas fa-medal fa-3x text-warning"></i>
                    </div>
                    <h5 class="feature-title mb-3">Quality Products</h5>
                    <p class="feature-description text-muted">Carefully curated products from trusted brands with
                        quality assurance and warranty.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Categories Section -->
<section id="categories" class="categories-section py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">Shop by Category</h2>
                <p class="section-subtitle text-muted">Explore our wide range of product categories</p>
            </div>
        </div>

        <div class="row g-4">
            {% for category in categories|slice:":8" %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="category-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="category-icon mb-3">
                        {% if category.image %}
                        <img src="{{ category.image.url }}" alt="{{ category.name }}" class="img-fluid rounded"
                            style="max-height: 80px;">
                        {% else %}
                        <i class="fas fa-box fa-3x text-primary"></i>
                        {% endif %}
                    </div>
                    <h5 class="category-title mb-2">{{ category.name }}</h5>
                    <p class="category-count text-muted mb-3">{{ category.get_products_count }} Products</p>
                    <a href="{{ category.get_absolute_url }}" class="btn btn-outline-primary btn-sm">
                        Browse Category
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <a href="#" class="btn btn-primary btn-lg">
                <i class="fas fa-th-large me-2"></i>View All Categories
            </a>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
<section id="featured-products" class="featured-products-section py-5 bg-light">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">Featured Products</h2>
                <p class="section-subtitle text-muted">Handpicked products you'll love</p>
            </div>
        </div>

        <div class="row g-4">
            {% for product in featured_products %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="product-card bg-white rounded shadow-sm h-100">
                    <div class="product-image position-relative">
                        {% if product.get_main_image %}
                        <img src="{{ product.get_main_image.url }}" alt="{{ product.name }}"
                            class="img-fluid rounded-top w-100" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center rounded-top"
                            style="height: 200px;">
                            <i class="fas fa-image fa-3x text-muted"></i>
                        </div>
                        {% endif %}

                        <!-- Product badges -->
                        <div class="product-badges position-absolute top-0 start-0 p-2">
                            {% if product.is_new_arrival %}
                            <span class="badge bg-success me-1">New</span>
                            {% endif %}
                            {% if product.is_featured %}
                            <span class="badge bg-primary me-1">Featured</span>
                            {% endif %}
                            {% if product.get_discount_percentage > 0 %}
                            <span class="badge bg-danger">{{ product.get_discount_percentage }}% OFF</span>
                            {% endif %}
                        </div>

                        <!-- Wishlist button -->
                        <button class="btn btn-light btn-sm position-absolute top-0 end-0 m-2 wishlist-btn"
                            data-product-id="{{ product.id }}" title="Add to Wishlist">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>

                    <div class="product-info p-3">
                        <h6 class="product-title mb-2">
                            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                                {{ product.name|truncatechars:50 }}
                            </a>
                        </h6>

                        <div class="product-rating mb-2">
                            {% for i in "12345" %}
                            {% if forloop.counter <= product.reviews.all|length %} <i class="fas fa-star text-warning">
                                </i>
                                {% else %}
                                <i class="far fa-star text-muted"></i>
                                {% endif %}
                                {% endfor %}
                                <span class="ms-1 text-muted small">({{ product.reviews.count }})</span>
                        </div>

                        <div class="product-price mb-3">
                            {% if product.compare_price and product.compare_price > product.price %}
                            <span class="text-muted text-decoration-line-through me-2">KES {{
                                product.compare_price|floatformat:2 }}</span>
                            {% endif %}
                            <span class="fw-bold text-primary">KES {{ product.price|floatformat:2 }}</span>
                        </div>

                        <div class="product-actions">
                            {% if product.is_in_stock %}
                            <button class="btn btn-primary btn-sm w-100 add-to-cart-btn"
                                data-product-id="{{ product.id }}" data-product-name="{{ product.name }}">
                                <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                            </button>
                            {% else %}
                            <button class="btn btn-secondary btn-sm w-100" disabled>
                                <i class="fas fa-times me-1"></i>Out of Stock
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <a href="#" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-eye me-2"></i>View All Products
            </a>
        </div>
    </div>
</section>

<!-- New Arrivals Section -->
<section class="new-arrivals-section py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">New Arrivals</h2>
                <p class="section-subtitle text-muted">Latest products just in</p>
            </div>
        </div>

        <div class="row g-4">
            {% for product in new_arrivals %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="product-card bg-white rounded shadow-sm h-100">
                    <div class="product-image position-relative">
                        {% if product.get_main_image %}
                        <img src="{{ product.get_main_image.url }}" alt="{{ product.name }}"
                            class="img-fluid rounded-top w-100" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center rounded-top"
                            style="height: 200px;">
                            <i class="fas fa-image fa-3x text-muted"></i>
                        </div>
                        {% endif %}

                        <span class="badge bg-success position-absolute top-0 start-0 m-2">New</span>
                    </div>

                    <div class="product-info p-3">
                        <h6 class="product-title mb-2">
                            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                                {{ product.name|truncatechars:50 }}
                            </a>
                        </h6>

                        <div class="product-price mb-3">
                            <span class="fw-bold text-primary">KES {{ product.price|floatformat:2 }}</span>
                        </div>

                        <div class="product-actions">
                            {% if product.is_in_stock %}
                            <button class="btn btn-primary btn-sm w-100 add-to-cart-btn"
                                data-product-id="{{ product.id }}" data-product-name="{{ product.name }}">
                                <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                            </button>
                            {% else %}
                            <button class="btn btn-secondary btn-sm w-100" disabled>
                                <i class="fas fa-times me-1"></i>Out of Stock
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Payment Methods Section -->
<section id="payment-methods" class="payment-methods-section py-5 bg-light">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">Secure Payment Methods</h2>
                <p class="section-subtitle text-muted">Multiple payment options for your convenience</p>
            </div>
        </div>

        <div class="row g-4 justify-content-center">
            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <div class="payment-method-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="payment-icon mb-3">
                        <i class="fas fa-mobile-alt fa-3x text-success"></i>
                    </div>
                    <h6 class="payment-title">M-Pesa</h6>
                    <p class="payment-description small text-muted">Instant mobile payments</p>
                </div>
            </div>

            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <div class="payment-method-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="payment-icon mb-3">
                        <i class="fas fa-credit-card fa-3x text-primary"></i>
                    </div>
                    <h6 class="payment-title">Credit/Debit Card</h6>
                    <p class="payment-description small text-muted">Secure card payments</p>
                </div>
            </div>

            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <div class="payment-method-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="payment-icon mb-3">
                        <i class="fas fa-money-bill-wave fa-3x text-warning"></i>
                    </div>
                    <h6 class="payment-title">Cash on Delivery</h6>
                    <p class="payment-description small text-muted">Pay when you receive</p>
                </div>
            </div>

            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                <div class="payment-method-card text-center p-3 bg-white rounded shadow-sm">
                    <div class="payment-icon mb-3">
                        <i class="fas fa-university fa-3x text-info"></i>
                    </div>
                    <h6 class="payment-title">Bank Transfer</h6>
                    <p class="payment-description small text-muted">Direct bank payments</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Delivery Info Section -->
<section id="delivery-info" class="delivery-info-section py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="section-title">Fast & Reliable Delivery</h2>
                <p class="section-subtitle text-muted">Get your products delivered across Kenya</p>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-4">
                <div class="delivery-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="delivery-icon mb-3">
                        <i class="fas fa-truck fa-3x text-primary"></i>
                    </div>
                    <h5 class="delivery-title mb-3">Home Delivery</h5>
                    <p class="delivery-description text-muted">Fast delivery to your doorstep across all 47 counties in
                        Kenya with real-time tracking.</p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="delivery-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="delivery-icon mb-3">
                        <i class="fas fa-store fa-3x text-success"></i>
                    </div>
                    <h5 class="delivery-title mb-3">Pickup Points</h5>
                    <p class="delivery-description text-muted">Convenient pickup points in major cities including
                        Nairobi, Mombasa, and Kisumu.</p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="delivery-card text-center p-4 bg-white rounded shadow-sm h-100">
                    <div class="delivery-icon mb-3">
                        <i class="fas fa-clock fa-3x text-warning"></i>
                    </div>
                    <h5 class="delivery-title mb-3">Express Delivery</h5>
                    <p class="delivery-description text-muted">Same-day delivery available in Nairobi and next-day
                        delivery in major cities.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section py-5 bg-primary text-white">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h3 class="mb-3">Stay Updated with Latest Offers</h3>
                <p class="mb-4">Subscribe to our newsletter and be the first to know about new products, special
                    discounts, and exclusive offers!</p>

                <form class="newsletter-form">
                    <div class="row g-3 justify-content-center">
                        <div class="col-md-8">
                            <input type="email" class="form-control form-control-lg"
                                placeholder="Enter your email address" required>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-light btn-lg w-100">
                                <i class="fas fa-paper-plane me-2"></i>Subscribe
                            </button>
                        </div>
                    </div>
                </form>

                <p class="small text-light mt-3">We respect your privacy. Unsubscribe at any time.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        // Add to cart functionality
        $('.add-to-cart-btn').click(function () {
            const productId = $(this).data('product-id');
            const productName = $(this).data('product-name');

            $.ajax({
                url: `/products/cart/add/${productId}/`,
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                success: function (response) {
                    if (response.success) {
                        // Show success message
                        showAlert('Success', `${productName} added to cart!`, 'success');

                        // Update cart count
                        updateCartCount(response.cart_items_count);
                    } else {
                        showAlert('Error', response.message || 'Failed to add product to cart', 'error');
                    }
                },
                error: function () {
                    showAlert('Error', 'Failed to add product to cart', 'error');
                }
            });
        });

        // Wishlist functionality
        $('.wishlist-btn').click(function () {
            const productId = $(this).data('product-id');
            const $btn = $(this);

            $.ajax({
                url: `/products/wishlist/add/${productId}/`,
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                success: function (response) {
                    if (response.success) {
                        $btn.find('i').removeClass('far').addClass('fas text-danger');
                        showAlert('Success', 'Product added to wishlist!', 'success');
                    } else {
                        showAlert('Error', response.message || 'Failed to add to wishlist', 'error');
                    }
                },
                error: function () {
                    showAlert('Error', 'Failed to add to wishlist', 'error');
                }
            });
        });

        // Helper functions
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function showAlert(title, message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const alertHtml = `
            <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                <strong>${title}:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;

            $('.main-content').prepend(alertHtml);

            // Auto-dismiss after 5 seconds
            setTimeout(function () {
                $('.alert').fadeOut();
            }, 5000);
        }

        function updateCartCount(count) {
            $('.cart .badge').text(count);
        }
    });
</script>
{% endblock %}



